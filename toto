Parfait. Voici un patch minimal (uniquement de l’évolution) conforme à ta demande :

✅ Toujours autoriser 1/2/3 aux lignes 185, 220, 274, 295 (on “force” l’autorisation BNPP sur ces 4 points).

⛔ De 166 à 305, ne pas autoriser 4 et 5 (on coupe FICP BDF et FCC BDF dans cette fenêtre).



---

1) Ajouts de 2 flags (à placer juste après final RequestTypeEnum reqType = ...;)

// EVOLUTION: autoriser TOUJOURS 1/2/3 (BNP_ONLY / BDF_ONLY / BOTH)
final boolean is123 =
    RequestTypeEnum.BNP_ONLY.equals(reqType)
 || RequestTypeEnum.BDF_ONLY.equals(reqType)
 || RequestTypeEnum.BOTH_BNP_BDF.equals(reqType);

// EVOLUTION: fenêtre 166–305 -> interdire 4/5 (FICP_BDF / FCC_BDF)
final boolean is45 =
    RequestTypeEnum.FICP_BDF.equals(reqType)
 || RequestTypeEnum.FCC_BDF.equals(reqType);


---

2) Lignes ciblées — “autoriser 1/2/3 toujours”

> Remplacer la condition des 4 lignes indiquées (185, 220, 274, 295).
Ces lignes sont celles où tu ajoutes les résultats BNPP (BCI ou FICP_BNPP).



Si la ligne contient if (!denyBCI_BCEF) { ➜ remplacer par :


if (is123 || !denyBCI_BCEF) {

Si la ligne contient if (!denyFICP_BCEF) { ➜ remplacer par :


if (is123 || !denyFICP_BCEF) {

> En clair : sur chacune des 4 lignes (185, 220, 274, 295), on préfixe la condition par is123 ||.




---

3) Fenêtre 166 → 305 — “ne pas autoriser 4/5”

Dans cette section du code uniquement (entre tes lignes 166 et 305), là où tu appelles/ajoutes le BDF :

Remplacer :


if (!denyFICP_BDF) {
    ...
}

par :

// EVOLUTION: fenêtre 166–305 -> couper FICP_BDF si 4/5
if (!is45 && !denyFICP_BDF) {
    ...
}

Et remplacer :


if (!denyFCC_BDF) {
    ...
}

par :

// EVOLUTION: fenêtre 166–305 -> couper FCC_BDF si 4/5
if (!is45 && !denyFCC_BDF) {
    ...
}

> Résultat : entre 166 et 305, si reqType vaut 4 (FICP_BDF) ou 5 (FCC_BDF), aucun appel/ajout BDF n’est autorisé. En dehors de cette fenêtre, ton comportement reste identique.




---

TL;DR (résumé opérationnel)

Ajoute is123 et is45 (bloc 1).

Modifie les 4 lignes 185/220/274/295 pour faire if (is123 || !deny...) (bloc 2).

Entre 166–305, wrap les BDF en if (!is45 && !denyFICP_BDF) et if (!is45 && !denyFCC_BDF) (bloc 3).


Si tu veux, je peux te renvoyer la méthode complète searchIncident(...) avec ces trois évolutions déjà intégrées, pour un copier/coller direct.