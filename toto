@echo off
setlocal
cd /d "%~dp0"

REM === NOMS DES FICHIERS ===
set "IN=input.sql"
set "OUT=output_ansi.sql"

REM === SI input.sql N'EXISTE PAS, PREND LE PREMIER .sql ===
if not exist "%IN%" (
  for %%F in (*.sql) do (
    set "IN=%%F"
    goto :GO
  )
  echo Aucun fichier .sql trouve.
  pause
  exit /b 1
)

:GO
echo Conversion de "%IN%" vers "%OUT%" ...
echo.

powershell -NoProfile -ExecutionPolicy Bypass -Command ^
"[IO.File]::WriteAllBytes('%OUT%', ([Text.Encoding]::GetEncoding(1252)).GetBytes(([Text.Encoding]::UTF8.GetString([IO.File]::ReadAllBytes('%IN%')))))"

echo.
echo Conversion terminee.
echo Fichier cree : %OUT%
pause
exit /b 0