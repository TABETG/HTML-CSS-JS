import difflib
import sys
import os

def comparer_fichiers(fichier1_path, fichier2_path, fichier_sortie="rapport_diff.html"):
    """
    Compare deux fichiers et g√©n√®re un rapport HTML c√¥te √† c√¥te.
    """
    
    # 1. V√©rification de l'existence des fichiers
    if not os.path.exists(fichier1_path):
        print(f"‚ùå Erreur : Le fichier '{fichier1_path}' est introuvable.")
        return
    if not os.path.exists(fichier2_path):
        print(f"‚ùå Erreur : Le fichier '{fichier2_path}' est introuvable.")
        return

    try:
        # 2. Lecture des fichiers
        # On utilise 'utf-8' pour g√©rer les accents
        with open(fichier1_path, 'r', encoding='utf-8') as f1:
            lignes_f1 = f1.readlines()
        
        with open(fichier2_path, 'r', encoding='utf-8') as f2:
            lignes_f2 = f2.readlines()

        print(f"üîÑ Comparaison de '{fichier1_path}' avec '{fichier2_path}' en cours...")

        # 3. G√©n√©ration du diff HTML
        # HtmlDiff cr√©e un tableau visuel style Notepad++ / WinMerge
        diff = difflib.HtmlDiff(wrapcolumn=80) # wrapcolumn √©vite que les lignes soient trop longues
        html_content = diff.make_file(lignes_f1, lignes_f2, fromdesc=fichier1_path, todesc=fichier2_path)

        # 4. Sauvegarde du rapport
        with open(fichier_sortie, 'w', encoding='utf-8') as f_out:
            f_out.write(html_content)
        
        print(f"‚úÖ Termin√© ! Le rapport a √©t√© g√©n√©r√© : {fichier_sortie}")
        print("üëâ Ouvrez ce fichier dans votre navigateur pour voir les diff√©rences.")

    except Exception as e:
        print(f"Une erreur est survenue : {e}")

# --- Configuration des fichiers √† comparer ---
if __name__ == "__main__":
    # Remplace ces noms par les chemins de tes vrais fichiers
    mon_fichier_A = "original.txt"
    mon_fichier_B = "modifie.txt"
    
    # Cr√©ation de fichiers de test si ils n'existent pas (pour que tu puisses tester le script de suite)
    if not os.path.exists(mon_fichier_A):
        with open(mon_fichier_A, "w", encoding="utf-8") as f:
            f.write("Ligne 1 : Ceci est le texte original.\nLigne 2 : Python est super.\nLigne 3 : √Ä garder.")
    
    if not os.path.exists(mon_fichier_B):
        with open(mon_fichier_B, "w", encoding="utf-8") as f:
            f.write("Ligne 1 : Ceci est le texte original.\nLigne 2 : Python est VRAIMENT super.\nLigne 4 : Une nouvelle ligne ajout√©e.")

    # Lancement de la comparaison
    comparer_fichiers(mon_fichier_A, mon_fichier_B)
